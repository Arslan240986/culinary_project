var __hasProp={}.hasOwnProperty,__extends=function(t,e){function i(){this.constructor=t}for(var s in e)__hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};(function(t){var e;t.fn.djangoFormset=function(e){return new t.fn.djangoFormset.Formset(this,e)},e=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return __extends(e,t),e}(Error),t.fn.djangoFormset.Formset=function(){function i(i,s){var n,o,r,a,h;if(this.opts=t.extend({},t.fn.djangoFormset.defaultOptions,s),0===i.length)throw new e("Empty selector.");if(this.template=i.filter("."+this.opts.formTemplateClass),0===this.template.length)throw new e("Can't find template (looking for ."+this.opts.formTemplateClass+")");if(r=this.template.find("input,select,textarea").first().attr("name"),!r)throw new e("Can't figure out form prefix because there's no form element in the form template. Please add one.");if(a=r.indexOf("-__prefix__"),-1===a)throw new e("Can't figure out form prefix from template because it doesn't contain '-__prefix__'.");if(this.prefix=r.substring(0,a),this.totalForms=t("#id_"+this.prefix+"-TOTAL_FORMS"),0===this.totalForms.length)throw new e("Management form field 'TOTAL_FORMS' not found for prefix "+this.prefix+".");this._initTabs(),o=i.not("."+this.opts.formTemplateClass),this.initialForms=o.length,t(this).on(this.opts.on),this.forms=o.map((h=this,function(e,i){var s,n,o;return h.hasTabs&&(o=t.djangoFormset.getTabActivator(i.id),n=new h.opts.tabClass(o.closest(".nav > *"))),s=new h.opts.formClass(t(i),h,e,n),t(h).trigger("formInitialized",[s]),s})),this.forms.length!==parseInt(this.totalForms.val())&&console.error("TOTAL_FORMS is "+this.totalForms.val()+", but "+this.forms.length+" non-template elements found in passed selection."),n=this.forms.filter(function(){return this.deleteInput.val()}),n.each(function(){return this.delete()}),this.insertAnchor=i.not("."+this.opts.formTemplateClass).last(),0===this.insertAnchor.length&&(this.insertAnchor=this.template)}return i.prototype._initTabs=function(){var i,s;if(this.hasTabs=this.template.is(".tab-pane"),this.hasTabs){if(i=t.djangoFormset.getTabActivator(this.template.attr("id")),0===i.length)throw new e("Template is .tab-pane but couldn't find corresponding tab activator.");if(s=i.closest(".nav"),0===s.length)throw new e("Template is .tab-pane but couldn't find corresponding .nav.");if(this.tabTemplate=s.children("."+this.opts.formTemplateClass),0===this.tabTemplate.length)throw new e("Tab nav template not found (looking for ."+this.opts.formTemplateClass+").")}},i.prototype.addForm=function(){var e,i,s,n,o;return this.hasTabs&&(n=this.tabTemplate.clone().removeClass(this.opts.formTemplateClass),s=new this.opts.tabClass(n),o=this.forms.length>0?this.forms[this.forms.length-1].tab.elem:this.tabTemplate,n.insertAfter(o)),i=this.template.clone().removeClass(this.opts.formTemplateClass),e=new this.opts.formClass(i,this,parseInt(this.totalForms.val()),s),i.insertAfter(this.insertAnchor),this.insertAnchor=i,this.forms.push(e),this.totalForms.val(parseInt(this.totalForms.val())+1),this.hasTabs&&s.activate(),t(this).trigger("formInitialized",[e]),t(this).trigger("formAdded",[e]),e},i.prototype.deleteForm=function(t){var e;e=this.forms[t],e.delete()},i.prototype.handleFormRemoved=function(t){var e,i,s,n,o;for(this.totalForms.val(parseInt(this.totalForms.val())-1),this.forms.splice(t,1),o=this.forms,i=s=0,n=o.length;s<n;i=++s)e=o[i],e._updateFormIndex(i);0===this.forms.length?this.insertAnchor=this.template:this.insertAnchor=this.forms[this.forms.length-1].elem},i}(),t.fn.djangoFormset.Form=function(){function e(t,e,i,s){var n;this.elem=t,this.formset=e,this.index=i,this.tab=s,this.elem.data("djangoFormset.Form",this),void 0!==this.index&&this._initFormIndex(this.index),this.deleteInput=this.field("DELETE"),n=this.index<this.formset.initialForms,(this.deleteInput.length>0||!n)&&this._replaceDeleteCheckboxWithButton()}return e.prototype.getDeleteButton=function(){return t("<div> "+this.formset.opts.deleteButtonText+" </div>")},e.prototype.insertDeleteButton=function(){this.deleteInput.length>0?this.deleteInput.after(this.deleteButton):(this.elem.is("TR")?this.elem.children().last():this.elem.is("UL")||this.elem.is("OL")?this.elem.append("li").children().last():this.elem).append(this.deleteButton)},e.prototype.delete=function(){var t,e,i;t=this.index<this.formset.initialForms,0===this.deleteInput.length&&t?console.warn("Tried do delete non-deletable form "+this.formset.prefix+" #"+this.index+"."):(this.tab&&this.tab.elem.is(".active")&&(i=this.formset.forms.map(function(t,e){return e.tab.elem[0]}),e=i.slice(this.index+1).filter(":visible").first(),0===e.length&&(e=i.slice(0,this.index).filter(":visible").last()),e.length>0&&e.data("djangoFormset.tab").activate()),t?(this.deleteInput.length>0&&this.deleteInput.val("on"),this.tab&&this.tab.elem.hide(),this.hide()):(this.tab&&this.tab.elem.remove(),this.elem.remove(),this.formset.handleFormRemoved(this.index)))},e.prototype.hide=function(){return this.elem.hide()},e.prototype.field=function(t){return this.elem.find("[name='"+this.formset.prefix+"-"+this.index+"-"+t+"']")},e.prototype.prev=function(){var t,e,i;for(i=this.formset.forms.slice(0,+(this.index-1)+1||9e9),e=i.length-1;e>=0;e+=-1)if(t=i[e],t.elem.is(":visible"))return t},e.prototype._replaceDeleteCheckboxWithButton=function(){var e,i,s;this.deleteInput.length>0&&(i=t("<input type='hidden' name='"+this.deleteInput.attr("name")+"' id='"+this.deleteInput.attr("id")+"' value='"+(this.deleteInput.is(":checked")?"on":"")+"'/>"),e=this.elem.find("label[for='"+this.deleteInput.attr("id")+"']"),e.has(this.deleteInput).length>0?e.replaceWith(i):(e.remove(),this.deleteInput.replaceWith(i)),this.deleteInput=i),this.deleteButton=this.getDeleteButton(),this.deleteButton.on("click",(s=this,function(t){return s.delete()})),this.insertDeleteButton()},e.prototype._replaceFormIndex=function(e,i){var s,n,o;this.index=i,n=new RegExp(this.formset.prefix+"-"+e),s=this.formset.prefix+"-"+i,o=function(t){var e,i,o,r,a,h,l;o={input:["id","name"],select:["id","name"],textarea:["id","name"],label:["for"],div:["id"],"*":["href","data-target"]},r=t.get(0).tagName,i=[],r.toLowerCase()in o&&(i=o[r.toLowerCase()]),i.push.apply(i,o["*"]),l=[];for(a=0,h=i.length;a<h;a++)e=i[a],t.attr(e)?l.push(t.attr(e,t.attr(e).replace(n,s))):l.push(void 0);return l},o(this.elem),this.elem.find("input, select, textarea, label").each(function(){o(t(this))}),this.tab&&(o(this.tab.elem),this.tab.elem.find("a, button").each(function(){o(t(this))}))},e.prototype._initFormIndex=function(t){this._replaceFormIndex("__prefix__",t)},e.prototype._updateFormIndex=function(t){this._replaceFormIndex("\\d+",t)},e}(),t.fn.djangoFormset.Tab=function(){function t(t){this.elem=t,this.elem.data("djangoFormset.tab",this)}return t.prototype.activate=function(){return this.elem.find("[data-toggle='tab']").trigger("click")},t.prototype.remove=function(){return this.elem.remove()},t}(),t.fn.djangoFormset.defaultOptions={formTemplateClass:"empty-form",formClass:t.fn.djangoFormset.Form,tabClass:t.fn.djangoFormset.Tab,deleteButtonText:"Delete"},t.djangoFormset={getTabActivator:function(e){return t("[href='#"+e+"'], [data-target='#"+e+"']")}}})(jQuery);